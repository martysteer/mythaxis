<!DOCTYPE HTML>
<html lang='{{ .Site.Language.Lang | default "en-us" }}'>
  {{ partial "htmlhead" . }}
  
  <body lang='{{ .Site.Language.Lang | default "en-us" }}' class="is-preload">
    {{/* Infer current section and lookup __index.md params for theming */}}
    {{ $currSection := .Section | default (urlize .Site.Params.currentIssue) }}
    {{ $currSection := .Site.GetPage "section" (print $currSection "/__index.md") }}
    
    {{/*  Get all stock pages for the current issue */}}
    {{ $posts := where (where .Site.Pages "Section" $currSection.Section) ".Type" "stock" }}

    {{/* Get first featured story, then remove it from the paging list */}}
    {{ $firstPost := first 1 (where $posts ".Params.featured" true) }}
    {{ $postsForPaging := $posts | complement $firstPost }}

    {{ if mod (len $postsForPaging) 2 }}
      {{ $lastPost := last 1 $postsForPaging}}
      {{ $postsForPaging := $postsForPaging | complement $lastPost }}
    {{ end }}

    {{/* Do the paging */}}
    {{ $postsPageSize := .Site.Params.Posts.pagesize | default 2 }}
    {{ $postsPaging := .Paginate $postsForPaging $postsPageSize }}
    
    <!-- Wrapper -->
      <div id="wrapper" class="fade-in" data-ps="{{ $postsPageSize }}" >
        {{ partial "intro.html" . }}

        {{ partial "header" . }}
        {{ partial "nav" . }}

        <!-- Main -->
          <div id="main">
            {{ if and (gt (len $firstPost) 0) (eq $postsPaging.PageNumber 1) }}
            {{ partial "stock/featured.html" (dict "firstpost" $firstPost "siteData" (index .Site.Data .Site.Language.Lang)) }}
            {{ end }}

            {{ if not (eq (len $posts) 1) }}
              {{ partial "stock/list.html" (dict "posts" $postsPaging "siteData" (index .Site.Data .Site.Language.Lang)) }}
            {{ end }}
            
          </div>

          {{ partial "copyright" . }}

          <a href="#navPanel" id="navPanelToggle">{{ i18n "NAV_MENU" . }}</a>
      </div>

      {{ template "_internal/google_analytics.html" . }}
      {{ partial "scripts/index" . }}

  </body>
</html>